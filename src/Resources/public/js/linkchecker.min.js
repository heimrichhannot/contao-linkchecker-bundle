!function(e){var t=setTimeout;function n(){}function r(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,r._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void s(t.promise,e)}i(t.promise,r)}else(1===e._state?i:s)(t.promise,e._value)})):e._deferreds.push(t)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void u(e);if("function"==typeof n)return void a((o=n,i=t,function(){o.apply(i,arguments)}),e)}e._state=1,e._value=t,u(e)}catch(t){s(e,t)}var o,i}function s(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&r._immediateFn(function(){e._handled||r._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)o(e,e._deferreds[t]);e._deferreds=null}function a(e,t){var n=!1;try{e(function(e){n||(n=!0,i(t,e))},function(e){n||(n=!0,s(t,e))})}catch(e){if(n)return;n=!0,s(t,e)}}r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,t,r)),r},r.all=function(e){var t=Array.prototype.slice.call(e);return new r(function(e,n){if(0===t.length)return e([]);var r=t.length;function o(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(e){o(i,e)},n)}t[i]=s,0==--r&&e(t)}catch(e){n(e)}}for(var i=0;i<t.length;i++)o(i,t[i])})},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(e){return new r(function(t,n){n(e)})},r.race=function(e){return new r(function(t,n){for(var r=0,o=e.length;r<o;r++)e[r].then(t,n)})},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},r._setImmediateFn=function(e){r._immediateFn=e},r._setUnhandledRejectionFn=function(e){r._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=r:e.Promise||(e.Promise=r)}(this),function(){var e,t=[];function e(e,t){if(this.element=e,this.options=t,this.url=this.element.getAttribute("data-url"),this.element.linkchecker=this,this.element.getAttribute("data-target")&&(this.target=document.querySelector(this.element.getAttribute("data-target"))),"undefined"==this.target)return!1;this.url||(this.url=window.location.href);var n={};this.url.replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(e,t,r){n[t]=void 0!==r?r:""}),this.params=n}e.prototype.test=function(){return e=this,new Promise(function(n,r){method="post",url=e.element.getAttribute("data-url");var o=new XMLHttpRequest;o.open(method,url,!0),o.withCredentials=!!e.options.withCredentials,response=null,updateProgress=function(){return function(e){}},o.onload=function(){var t;if(4!==o.readyState&&r({status:this.status,statusText:o.statusText}),response=o.responseText,o.getResponseHeader("content-type")&&~o.getResponseHeader("content-type").indexOf("application/json"))try{response=JSON.parse(response)}catch(e){response="Invalid JSON response from server."}200<=(t=o.status)&&t<300?(e._finished(response),n(o.response)):r({status:this.status,statusText:o.statusText})},o.onerror=function(){r({status:this.status,statusText:o.statusText})},progressObj=null!=(_ref=o.upload)?_ref:o,progressObj.onprogress=updateProgress,headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},e.options.headers&&extend(headers,e.options.headers);for(headerName in headers)headerValue=headers[headerName],headerValue&&o.setRequestHeader(headerName,headerValue);if(formData=new FormData,e.params){_ref1=e.params;for(key in _ref1)value=_ref1[key],formData.append(key,value)}t.push(o),e.submitRequest(o,formData)});var e},e.prototype.submitRequest=function(e,t){e.send(t)},e.prototype._finished=function(e){return void 0!==e.result&&"html"in e.result?(this.target.innerHTML=e.result.html,!0):(this.target.innerHTML="-",!1)},LinkCheckerRegistry={init:function(){this.register()},abort:function(){this.stopRecursion=!0},runRecursiveFunction:function(e,arguments,t){arguments.length<1?void 0!==t&&t():e(arguments[0],Array.prototype.slice.call(arguments,1),t)},register:function(){var n=document.querySelectorAll("[data-linkchecker]"),r={};!function(o){o.runRecursiveFunction(function n(i,s,u){if(o.stopRecursion)for(var a=0,c=t.length;a<c;a++)t[a].abort();else void 0===i.linkchecker?new e(i,r).test().then(function(){o.runRecursiveFunction(n,s,u)}).catch(function(e){o.runRecursiveFunction(n,s,u)}):o.runRecursiveFunction(n,s,u)},n)}(this)}},document.addEventListener("DOMContentLoaded",function(e){LinkCheckerRegistry.init()}),window.addEventListener("beforeunload",function(e){LinkCheckerRegistry.abort()}),window.jQuery&&jQuery(document).ajaxComplete(function(){LinkCheckerRegistry.init()}),window.MooTools&&window.addEvent("ajax_change",function(){LinkCheckerRegistry.init()})}.call(this);